"""
SmolTalk by HuggingFace. Good "general" conversational dataset.
https://huggingface.co/datasets/HuggingFaceTB/smol-smoltalk
We use the "smol" version, which is more appropriate for smaller models.
"""

from datasets import load_dataset
from tasks.common import Task

class SmolTalk(Task):
    """ smol-smoltalk dataset. train is 460K rows, test is 24K rows. """

    def __init__(self, split, **kwargs):
        super().__init__(**kwargs)
        assert split in ["train", "test"], "SmolTalk split must be train|test"
        self.ds = load_dataset("HuggingFaceTB/smol-smoltalk", split=split).shuffle(seed=42)
        self.length = len(self.ds)

    def num_examples(self):
        return len(self.ds)
    
    def get_example(self, index):
        row = self.ds[index]
        messages = row['messages']
        # ---------------------------------------------------------------------
        # sanity checking asserts here
        # TODO: we could remove these asserts later, for now just don't want any footguns
        # there is an optional system message at the beginning
        assert len(messages) >= 1
        first_message = messages[0]
        if first_message["role"] == "system":
            rest_messages = messages[1:] # optional system message is OK
        else:
            rest_messages = messages
        assert len(rest_messages) >=2 , "SmolTalk messages must have atleast 2 message"
        for i, message in enumerate(rest_messages):
            # user and assistant alternate as user,assistant,user,assistant,...
            expected_role = "user" if i % 2 == 0 else "assistant"
            assert message["role"] == expected_role, f"Message {i} has a role {messages['role']} but should be {expected_role}"
            assert isinstance(message['content'], str), "Content must be a string"
        # ---------------------------------------------------------------------
        # create and return the Conversation object (ok to emit the system message too)
        conversation = {
            "messages": messages,
        }
        return conversation

"""

python -m tasks.common
Length of SmolTalk: 24229

5th example is: {'messages': [{'content': "I'm trying to understand the relationship between income and household size. I have a dataset with average household incomes for different household sizes (from 1 to 6 people). I've calculated the mean income for each household size, but I'm not sure how to interpret the results or what kind of analysis would be best to understand the relationship between these two variables.\n\nIncome ($):\n- 1 person: 38,400\n- 2 people: 51,200\n- 3 people: 63,500\n- 4 people: 76,800\n- 5 people: 85,100\n- 6 people: 93,300\n\nHow should I proceed to gain insights into the relationship between income and household size?", 'role': 'user'}, {'content': "To gain insights into the relationship between income and household size, let's first examine the overall trend in your data. The mean incomes you provided show a steady increase as household size grows. This suggests a positive relationship between the two variables.\n\nOne way to further analyze this relationship is to calculate the average increase in income per additional household member. This can be done by finding the difference in mean income between consecutive household sizes.\n\nFor example, the difference in mean income between households of 1 and 2 people is $12,800 ($51,200 - $38,400). Similarly, the difference between households of 2 and 3 people is $12,300 ($63,500 - $51,200). \n\nBy calculating these differences, you can see that the increase in income per additional household member is not constant, but it does follow a generally consistent pattern. This pattern could indicate that each additional household member contributes to the overall income, but with diminishing returns.\n\nAnother approach would be to visualize the data using a scatter plot or a bar chart, with household size on the x-axis and mean income on the y-axis. This can help illustrate the relationship between the two variables and may reveal any outliers or anomalies in the data.\n\nAdditionally, you may want to consider calculating the income per capita (i.e., income per person) for each household size. This can provide insight into whether the increase in income is solely due to the additional household members or if there are other factors at play.\n\nLastly, consider exploring other factors that may influence the relationship between income and household size, such as geographic location, education level, or occupation. By controlling for these variables, you may uncover more nuanced insights into the relationship between income and household size.", 'role': 'assistant'}, {'content': 'How is income per capita calculated?', 'role': 'user'}, {'content': 'Income per capita is calculated by dividing the total household income by the number of people in the household. Using your original data, you can calculate the income per capita for each household size as follows:\n\n- 1 person: $38,400 / 1 = $38,400\n- 2 people: $51,200 / 2 = $25,600\n- 3 people: $63,500 / 3 = $21,167\n- 4 people: $76,800 / 4 = $19,200\n- 5 people: $85,100 / 5 = $17,020\n- 6 people: $93,300 / 6 = $15,550\n\nBy calculating income per capita, you can see that as household size increases, the income per person actually decreases. This suggests that while total household income may be higher for larger households, the individual members of those households may not necessarily be better off in terms of their personal income.\n\nThis finding could have implications for understanding poverty rates, economic inequality, and the overall standard of living within households of different sizes. It may also highlight the importance of considering household size when evaluating economic data and making policy decisions related to income support and resource allocation.', 'role': 'assistant'}, {'content': "Income per person decreases as family size increases but if a small percentage of high income people have large families wouldn't that alone create the illusion that most or all large families have lower per capita income?", 'role': 'user'}, {'content': "You're raising a crucial point. If a small percentage of high-income individuals have large families, it's possible that the average income per capita for larger households is being skewed by the broader population of large families with lower incomes. This phenomenon is known as Simpson's paradox.\n\nSimpson's paradox occurs when a trend or pattern that appears to hold true for a group as a whole is reversed or distorted when the group is broken down into subgroups. In this case, the paradox might arise if the high-income individuals with large families are not representative of the typical large family.\n\nTo better understand the relationship between household size and income per capita, it would be helpful to examine the distribution of incomes within each household size category. If there is significant income inequality within the larger household size categories, it's possible that the average income per capita is being pulled down by a larger number of lower-income households.\n\nOne way to address this issue would be to calculate the median income per capita instead of the mean. The median is less sensitive to extreme values, so it might provide a more accurate representation of the typical household's income per capita.\n\nAnother approach would be to use more advanced statistical techniques, such as regression analysis, to control for other factors that might influence the relationship between household size and income per capita. By accounting for variables like education level, occupation, and geographic location, you might be able to isolate the specific effect of household size on income per capita and gain a more nuanced understanding of the underlying trends.", 'role': 'assistant'}]}

Length of sliced SmolTalk[5:10]:  5

0th example of sliced SmolTalk:  {'messages': [{'content': "I'm trying to understand the relationship between income and household size. I have a dataset with average household incomes for different household sizes (from 1 to 6 people). I've calculated the mean income for each household size, but I'm not sure how to interpret the results or what kind of analysis would be best to understand the relationship between these two variables.\n\nIncome ($):\n- 1 person: 38,400\n- 2 people: 51,200\n- 3 people: 63,500\n- 4 people: 76,800\n- 5 people: 85,100\n- 6 people: 93,300\n\nHow should I proceed to gain insights into the relationship between income and household size?", 'role': 'user'}, {'content': "To gain insights into the relationship between income and household size, let's first examine the overall trend in your data. The mean incomes you provided show a steady increase as household size grows. This suggests a positive relationship between the two variables.\n\nOne way to further analyze this relationship is to calculate the average increase in income per additional household member. This can be done by finding the difference in mean income between consecutive household sizes.\n\nFor example, the difference in mean income between households of 1 and 2 people is $12,800 ($51,200 - $38,400). Similarly, the difference between households of 2 and 3 people is $12,300 ($63,500 - $51,200). \n\nBy calculating these differences, you can see that the increase in income per additional household member is not constant, but it does follow a generally consistent pattern. This pattern could indicate that each additional household member contributes to the overall income, but with diminishing returns.\n\nAnother approach would be to visualize the data using a scatter plot or a bar chart, with household size on the x-axis and mean income on the y-axis. This can help illustrate the relationship between the two variables and may reveal any outliers or anomalies in the data.\n\nAdditionally, you may want to consider calculating the income per capita (i.e., income per person) for each household size. This can provide insight into whether the increase in income is solely due to the additional household members or if there are other factors at play.\n\nLastly, consider exploring other factors that may influence the relationship between income and household size, such as geographic location, education level, or occupation. By controlling for these variables, you may uncover more nuanced insights into the relationship between income and household size.", 'role': 'assistant'}, {'content': 'How is income per capita calculated?', 'role': 'user'}, {'content': 'Income per capita is calculated by dividing the total household income by the number of people in the household. Using your original data, you can calculate the income per capita for each household size as follows:\n\n- 1 person: $38,400 / 1 = $38,400\n- 2 people: $51,200 / 2 = $25,600\n- 3 people: $63,500 / 3 = $21,167\n- 4 people: $76,800 / 4 = $19,200\n- 5 people: $85,100 / 5 = $17,020\n- 6 people: $93,300 / 6 = $15,550\n\nBy calculating income per capita, you can see that as household size increases, the income per person actually decreases. This suggests that while total household income may be higher for larger households, the individual members of those households may not necessarily be better off in terms of their personal income.\n\nThis finding could have implications for understanding poverty rates, economic inequality, and the overall standard of living within households of different sizes. It may also highlight the importance of considering household size when evaluating economic data and making policy decisions related to income support and resource allocation.', 'role': 'assistant'}, {'content': "Income per person decreases as family size increases but if a small percentage of high income people have large families wouldn't that alone create the illusion that most or all large families have lower per capita income?", 'role': 'user'}, {'content': "You're raising a crucial point. If a small percentage of high-income individuals have large families, it's possible that the average income per capita for larger households is being skewed by the broader population of large families with lower incomes. This phenomenon is known as Simpson's paradox.\n\nSimpson's paradox occurs when a trend or pattern that appears to hold true for a group as a whole is reversed or distorted when the group is broken down into subgroups. In this case, the paradox might arise if the high-income individuals with large families are not representative of the typical large family.\n\nTo better understand the relationship between household size and income per capita, it would be helpful to examine the distribution of incomes within each household size category. If there is significant income inequality within the larger household size categories, it's possible that the average income per capita is being pulled down by a larger number of lower-income households.\n\nOne way to address this issue would be to calculate the median income per capita instead of the mean. The median is less sensitive to extreme values, so it might provide a more accurate representation of the typical household's income per capita.\n\nAnother approach would be to use more advanced statistical techniques, such as regression analysis, to control for other factors that might influence the relationship between household size and income per capita. By accounting for variables like education level, occupation, and geographic location, you might be able to isolate the specific effect of household size on income per capita and gain a more nuanced understanding of the underlying trends.", 'role': 'assistant'}]}

They match:  True

10th Example of the sliced SmolTalk for viz:  {'messages': [{'content': 'A friend who is an artist has to come up with some unique art pieces for her exhibit. What are some ideas for her?', 'role': 'user'}, {'content': 'What an exciting challenge. Here are some ideas to get your friend\'s creative juices flowing. She could create an immersive experience by designing an interactive light installation that responds to sound or movement, inviting viewers to become a part of the art itself. Alternatively, she could experiment with unconventional materials like repurposed plastic waste, fabric scraps, or found objects to craft intricate sculptures that tell a story about sustainability and consumerism.\n\nPerhaps she could explore the realm of augmented reality, creating pieces that blur the lines between physical and digital art. Using AR technology, she could bring her paintings or sculptures to life, allowing viewers to unlock hidden layers and meanings. Or, she might focus on the ephemeral nature of art, crafting delicate, site-specific installations from natural materials like sand, leaves, or ice that change and decay over time.\n\nAnother direction could be to create a series of "memory boxes" – intricate, detailed dioramas that capture moments from her own life or the lives of others, inviting viewers to reflect on their own memories and experiences. She might also play with the concept of scale, crafting massive, larger-than-life sculptures that dominate the space or, conversely, tiny, intricate pieces that require viewers to slow down and observe closely.\n\nLastly, she could delve into the world of participatory art, designing pieces that rely on viewer input and collaboration to evolve and change over the course of the exhibit. This could involve crowdsourced storytelling, communal drawing projects, or even a "wishing tree" where viewers can tie notes with their hopes and dreams, creating a collective, ever-growing art piece. These ideas should give your friend a solid starting point for creating some truly unique and thought-provoking art pieces for her exhibit.', 'role': 'assistant'}, {'content': 'What can the artists do with immersive installations?', 'role': 'user'}, {'content': 'Immersive installations offer a wide range of possibilities for artists to push boundaries and engage viewers on a deeper level. Your friend could create a dreamlike environment by designing a room filled with fog, mirrors, or LED lights that alter the viewer\'s perception of space and self. She might also experiment with soundscapes, crafting an immersive audio experience that responds to the viewer\'s movement, creating an otherworldly atmosphere.\n\nAnother idea would be to create a "room within a room" – a smaller, intimate space within the larger exhibit that invites viewers to step inside and become a part of the art. This could be a recreation of a childhood memory, a futuristic pod, or even a sensory deprivation chamber. The artist could also incorporate tactile elements, such as textured walls, temperature-controlled environments, or scented air, to engage the viewer\'s senses and create a truly immersive experience.\n\nShe might draw inspiration from nature, recreating an immersive forest environment with living plants, sounds of wildlife, and soft, dappled lighting. Alternatively, she could explore the concept of infinity, designing a room with mirrored ceilings, floors, and walls that create an endless, dizzying reflection, challenging the viewer\'s perception of space and reality.\n\nThe artist could also incorporate performance and storytelling into the installation, using actors, projection mapping, or interactive technology to bring the space to life. This could involve a choose-your-own-adventure style narrative, where viewers make choices that alter the story and environment in real-time, or a more abstract, interpretive performance that responds to the viewer\'s movement and energy.\n\nLastly, she might experiment with the concept of "slow art," creating an immersive environment that rewards slow, contemplative viewing. This could involve a dark room with a single, slowly changing light source, or a space filled with intricate, detailed patterns that require viewers to slow down and observe closely. By creating an immersive installation, your friend can invite viewers to step into her world and experience her art in a more intimate, engaging way.', 'role': 'assistant'}, {'content': 'With that said, what would be some good ideas for slow art pieces which make viewers slow down.', 'role': 'user'}, {'content': 'Slow art pieces are a wonderful way to encourage viewers to slow down, observe closely, and engage with the art on a deeper level. Here are some ideas for slow art pieces that might inspire your friend. She could create a series of intricate, hand-drawn mandalas or patterns on large, floor-to-ceiling sheets of paper or canvas, inviting viewers to step up close and get lost in the details.\n\nAnother idea would be to design a room filled with slowly changing light, using a combination of natural and artificial light sources to create an otherworldly atmosphere. The light could shift and change over the course of the day, or in response to the viewer\'s movement, creating a sense of gradual, incremental change. The artist could also experiment with the concept of "slow motion" – using slow-moving video or animation to capture everyday moments or natural processes, like the movement of clouds or the growth of plants.\n\nShe might create a series of tiny, detailed sculptures or models that require viewers to slow down and observe closely to appreciate their intricacy. These could be miniature landscapes, cities, or buildings, or even tiny, abstract forms that reward close inspection. Alternatively, she could design a sound installation that features slow, gradual changes in sound – a slowly rising tone, a gradual build-up of whispers, or a soft, repetitive melody that shifts and changes over time.\n\nThe artist could also explore the concept of "decay" or " entropy" – creating pieces that change and deteriorate over time, like a slowly melting ice sculpture, a wilting flower arrangement, or a series of photographs that fade or degrade over the course of the exhibit. This could be a powerful way to comment on the transience of life and the fleeting nature of human experience.\n\nAnother idea would be to create a "slow-motion performance" – using actors or performers to recreate everyday activities in slow motion, like eating a meal, walking across a room, or engaging in conversation. This could be a fascinating way to highlight the beauty and complexity of everyday human experience, and encourage viewers to slow down and appreciate the beauty in the mundane.\n\nLastly, she might experiment with the concept of "hidden" or "invisible" art – creating pieces that are only visible under certain conditions, like black light, or that require viewers to slow down and look closely to appreciate their presence. This could involve using invisible ink, subtle scents, or other hidden elements to create an art piece that rewards slow, attentive viewing. By creating slow art pieces, your friend can encourage viewers to slow down, engage more deeply with the art, and appreciate the beauty in the details.', 'role': 'assistant'}]}

"""